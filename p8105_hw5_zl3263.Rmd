---
title: "p8105_hw5_zl3263"
output: github_document
date: "2022-11-15"
---

```{r}
library(tidyverse)
library(purrr)
```

### Problem 2

```{r}
homicides = read_csv("https://raw.githubusercontent.com/washingtonpost/data-homicides/master/homicide-data.csv")%>%
   janitor::clean_names()
  
```

**Description**

The dataset record the homicides  information of 50 U.S cities. It contains `r nrow(homicides_raw)` observations and `r ncol(homicides_raw)` variables.The key variables include victims' name, sex, age and race. The location(`city`,`state`,`lat`,`lon`) and report time are also recorded.

**Count unsolved numbers**

```{r}
homicides = homicides %>%
  mutate(
    city_state = paste(city,",",state)
  )

solve_count = homicides %>%
  group_by(city_state) %>%
  summarise(
    total = n(),
    unsolved = sum(disposition == "Closed without arrest") + sum(disposition == "Open/No arrest")
    
  )

solve_count
```
**Proportion test on Baltimore**

```{r}
test_baltimore = prop.test(1825, 2827)%>%
  broom::tidy()
test_baltimore
```
**Proportion test on all the cities**

```{r}
solve_count = 
solve_count %>%
  mutate(
    prop_test = map2(.x = unsolved, .y = total, ~ broom::tidy(prop.test(.x, .y)))
  ) %>%
  unnest(cols = prop_test) %>%
  select(-c("parameter","method","alternative"))

head(solve_count)
```

**Plot**
```{r}
solve_count %>%
  ggplot(aes(x = reorder(city_state, estimate), y = estimate)) +
	  geom_point() +
	  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
	  labs(
	  	x = "Cities",
	  	y = "Estimates with Confidence Intervals",
	  	title = "Proportion of unsolved cases"
	  ) +
	  theme(
	  	axis.text.x = element_text(angle = 90)
	  )

  
```

